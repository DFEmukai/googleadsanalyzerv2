# Google広告AIエージェント 要件定義書

## 1. プロジェクト概要

### 目的
Google広告の運用を自律的に分析し、予算効果の最大化に向けた改善提案を行うAIエージェントを構築する。

### 基本方針
- 週次で自動分析・改善提案を実行
- 人間による承認→実行フロー（将来的には自動化）
- 過去の結果を記憶し、継続的に学習・改善
- 全階層（会長〜現場作業者）が閲覧できるダッシュボード

---

## 2. システム構成

### 2.1 対象アカウント
- 自社グループ広告アカウント（1アカウント）
- キャンペーン数：16〜30件

### 2.2 広告タイプ
- 検索広告
- ディスプレイ広告
- P-MAX
- 動画広告（YouTube）

### 2.3 APIアクセス
- Google Ads API（Explorer Access）
- 1日あたり最大2,880オペレーション
- 週次実行のため十分な余裕あり

---

## 3. 機能要件

### 3.1 週次分析レポート機能

**実行タイミング**
- 毎週月曜 9:00までに完了

**分析対象期間**
- 直近7日間（先週の月曜〜日曜）
- 前週比・前月同週比の比較

**分析項目**

| カテゴリ | 分析内容 |
|---------|---------|
| パフォーマンス | 費用、CV数、CPA、CTR、ROAS、インプレッションシェア |
| キャンペーン別 | 各キャンペーンの成績、予算消化率、目標達成度 |
| 広告グループ別 | 上位/下位パフォーマンス、改善余地の特定 |
| キーワード | CVキーワード、除外候補、新規追加候補 |
| 検索語句 | マッチタイプ最適化、除外キーワード候補 |
| クリエイティブ | 広告文CTR/CVR、アセット評価、画像パフォーマンス |
| オーディエンス | ターゲット別成績、拡張/除外候補 |
| デバイス | PC/モバイル/タブレット別パフォーマンス |
| 時間帯・曜日 | 配信効率の高い/低い時間帯 |
| 地域 | 地域別パフォーマンス、入札調整候補 |
| 予算 | 予算制限による機会損失、再配分提案 |

### 3.2 改善提案機能

**提案カテゴリ**
1. **キーワード改善**
   - 追加推奨キーワード
   - 除外推奨キーワード
   - マッチタイプ変更提案

2. **広告文改善**
   - 見出し改善案（具体的な代替文）
   - 説明文改善案
   - A/Bテスト候補

3. **画像・動画改善**
   - パフォーマンス低いアセットの差し替え提案
   - 新規クリエイティブの方向性

4. **ターゲティング改善**
   - オーディエンス拡張/絞り込み
   - デバイス入札調整
   - 時間帯・曜日の入札調整
   - 地域入札調整

5. **予算配分改善**
   - キャンペーン間の予算再配分
   - 日予算の調整提案

6. **入札戦略改善**
   - 目標CPA/ROAS の調整
   - 入札戦略の変更提案

**提案フォーマット**
- 各提案に「優先度」（高/中/低）を付与
- 「期待効果」の概算を記載
- 「実行手順」を明記

### 3.3 改善実行チェック機能

**目的**
人間が承認した改善提案が正しく反映されたか検証する

**チェック内容**
- 前週の提案事項の実行状況
- 実行済み/未実行/エラーの分類
- エラー項目の原因表示・再実行オプション
- 実行後の効果検証（実行から1週間後）

### 3.4 承認・自動反映フロー

#### 3.4.1 基本フロー

```
┌─────────────────────────────────────────────────────────────┐
│  AIが改善提案を生成                                          │
│       ↓                                                      │
│  ダッシュボードに提案一覧を表示                               │
│       ↓                                                      │
│  人間が内容を確認し「承認」ボタンをクリック                   │
│       ↓                                                      │
│  システムがGoogle Ads APIで自動反映                          │
│       ↓                                                      │
│  反映結果（成功/失敗）をダッシュボードに表示                  │
│       ↓                                                      │
│  翌週、効果検証を自動実行                                    │
└─────────────────────────────────────────────────────────────┘
```

#### 3.4.2 承認オプション

| ボタン | 動作 |
|--------|------|
| 承認（即時反映） | Google Ads APIで即座に反映 |
| 承認（予約反映） | 指定日時にバッチで反映 |
| 保留 | 判断を次週に持ち越し |
| 却下 | 実行しない（理由入力可） |

#### 3.4.3 承認時の編集機能

**承認前に内容を編集可能**

提案をそのまま承認するだけでなく、内容を調整してから承認できる。

```
┌─────────────────────────────────────────────────────────────┐
│  提案：キャンペーン「〇〇」の日予算を増額                      │
├─────────────────────────────────────────────────────────────┤
│  現在の日予算    ：¥10,000                                   │
│  AIの提案額      ：¥15,000（+50%）                           │
│  ─────────────────────────────────────                      │
│  反映する金額    ：[  ¥12,000  ] ← 編集可能                  │
│                                                              │
│  [承認して反映]  [保留]  [却下]                               │
└─────────────────────────────────────────────────────────────┘
```

**編集可能な項目**

| カテゴリ | 編集可能な項目 |
|---------|---------------|
| 予算 | 日予算の金額 |
| 入札 | 目標CPA、目標ROAS、入札単価 |
| キーワード | 追加/除外するキーワード（リストから削除可） |
| 広告文 | 見出し、説明文のテキスト |
| ターゲティング | 入札調整率（%） |

**編集履歴の記録**

- AI提案の元の値
- 人間が編集した値
- 編集理由（任意入力）

→ 次回以降の提案精度向上に活用

#### 3.4.4 自動反映可能な操作

**Google Ads APIで書き込み可能な項目**

| カテゴリ | 操作内容 | API対応 |
|---------|---------|---------|
| キーワード | 追加 | ○ |
| キーワード | 除外追加 | ○ |
| キーワード | 入札単価変更 | ○ |
| キーワード | 一時停止/有効化 | ○ |
| 広告文 | 新規追加 | ○ |
| 広告文 | 一時停止/有効化 | ○ |
| 広告文 | 削除 | ○ |
| 入札 | 目標CPA変更 | ○ |
| 入札 | 目標ROAS変更 | ○ |
| 予算 | 日予算変更 | ○ |
| ターゲティング | デバイス入札調整 | ○ |
| ターゲティング | 時間帯入札調整 | ○ |
| ターゲティング | 地域入札調整 | ○ |
| 画像/動画 | アセット追加 | △（要確認） |

#### 3.4.5 反映時のセーフガード

**安全装置**
```
┌─────────────────────────────────────────────────────────────┐
│  1. 変更プレビュー表示                                       │
│     - 承認前に「何がどう変わるか」を明示                      │
│     - 変更前後の比較表示                                     │
│                                                              │
│  2. 変更上限の設定                                           │
│     - 1回の承認で変更できる項目数の上限（例：10件）           │
│     - 予算変更は±20%までに制限（設定で変更可能）              │
│                                                              │
│  3. ロールバック機能                                         │
│     - 反映後24時間以内なら「元に戻す」が可能                  │
│     - 変更履歴をすべて記録                                   │
│                                                              │
│  4. 高リスク操作の二重確認                                   │
│     - 予算大幅変更、キャンペーン停止などは追加確認ダイアログ   │
└─────────────────────────────────────────────────────────────┘
```

#### 3.4.6 反映ステータス

| ステータス | 説明 |
|-----------|------|
| pending | 承認待ち |
| approved | 承認済み・反映待ち |
| processing | 反映処理中 |
| success | 反映成功 |
| failed | 反映失敗（エラー内容表示） |
| rolled_back | ロールバック済み |

#### 3.4.7 エラーハンドリング

**反映失敗時の対応**
- エラー内容をダッシュボードに表示
- 担当者にChatwork通知
- 再実行ボタンを表示
- 失敗が続く場合は手動対応を促す

**よくあるエラー例**
- ポリシー違反（広告文に禁止ワードが含まれる）
- 予算超過
- APIレート制限
- キャンペーンが既に停止済み

### 3.5 メモリ・学習機能

#### 3.5.1 基本方針

**重要：AIエージェントは「学習」はできないが「参照」はできる**

Claude APIは会話ごとにリセットされるため、過去の提案や結果を「学習」して内部に保持することはできない。そのため、**毎回の分析時に過去データを必ず参照（RAG的アプローチ）** することで、擬似的な学習効果を実現する。

**絶対ルール：新しい改善提案を出す前に、過去の提案→実行→結果の履歴を必ず参照すること**

#### 3.5.2 データ構造

```
┌─────────────────────────────────────────────────────────────┐
│  weekly_reports（週次レポート）                               │
├─────────────────────────────────────────────────────────────┤
│  report_id          : UUID                                   │
│  week_start_date    : DATE（週の開始日）                      │
│  week_end_date      : DATE（週の終了日）                      │
│  created_at         : TIMESTAMP                              │
│  raw_data           : JSON（Google Ads APIから取得した生データ）│
│  analysis_summary   : TEXT（分析サマリー）                    │
│  kpi_snapshot       : JSON（その週のKPI値）                   │
│    - total_cost                                              │
│    - total_conversions                                       │
│    - cpa                                                     │
│    - ctr                                                     │
│    - roas                                                    │
│    - impression_share                                        │
└─────────────────────────────────────────────────────────────┘
           │
           │ 1:N
           ▼
┌─────────────────────────────────────────────────────────────┐
│  improvement_proposals（改善提案）                            │
├─────────────────────────────────────────────────────────────┤
│  proposal_id        : UUID                                   │
│  report_id          : FK → weekly_reports                    │
│  category           : ENUM                                   │
│    - keyword（キーワード）                                    │
│    - ad_copy（広告文）                                        │
│    - creative（画像・動画）                                   │
│    - targeting（ターゲティング）                              │
│    - budget（予算）                                          │
│    - bidding（入札）                                         │
│  priority           : ENUM（high / medium / low）            │
│  title              : TEXT（提案タイトル）                    │
│  description        : TEXT（詳細説明）                        │
│  expected_effect    : TEXT（期待効果）                        │
│  action_steps       : JSON（実行手順）                        │
│  target_campaign    : TEXT（対象キャンペーン名）              │
│  target_ad_group    : TEXT（対象広告グループ名、あれば）       │
│  status             : ENUM                                   │
│    - pending（承認待ち）                                      │
│    - approved（承認済み・未実行）                             │
│    - executed（実行済み）                                     │
│    - rejected（却下）                                        │
│    - skipped（スキップ）                                     │
│  created_at         : TIMESTAMP                              │
└─────────────────────────────────────────────────────────────┘
           │
           │ 1:1
           ▼
┌─────────────────────────────────────────────────────────────┐
│  proposal_executions（提案の実行記録）                        │
├─────────────────────────────────────────────────────────────┤
│  execution_id       : UUID                                   │
│  proposal_id        : FK → improvement_proposals             │
│  executed_at        : TIMESTAMP（実行日時）                   │
│  executed_by        : TEXT（実行者名）                        │
│  execution_notes    : TEXT（実行時のメモ）                    │
│  actual_changes     : JSON（実際に行った変更内容）            │
└─────────────────────────────────────────────────────────────┘
           │
           │ 1:1
           ▼
┌─────────────────────────────────────────────────────────────┐
│  proposal_results（提案の効果測定）                           │
├─────────────────────────────────────────────────────────────┤
│  result_id          : UUID                                   │
│  proposal_id        : FK → improvement_proposals             │
│  measured_at        : TIMESTAMP（測定日時）                   │
│  measurement_period : TEXT（測定期間：1週間後、2週間後など）   │
│  before_metrics     : JSON（実行前のKPI）                     │
│    - cpa                                                     │
│    - ctr                                                     │
│    - cvr                                                     │
│    - conversions                                             │
│    - cost                                                    │
│  after_metrics      : JSON（実行後のKPI）                     │
│  effect_summary     : TEXT（効果サマリー：改善/悪化/変化なし） │
│  effect_percentage  : DECIMAL（変化率 %）                     │
│  ai_evaluation      : TEXT（AIによる効果の評価コメント）      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  learning_insights（学習インサイト）                          │
├─────────────────────────────────────────────────────────────┤
│  insight_id         : UUID                                   │
│  created_at         : TIMESTAMP                              │
│  insight_type       : ENUM                                   │
│    - effective_pattern（効果があったパターン）                │
│    - ineffective_pattern（効果がなかったパターン）            │
│    - seasonal_trend（季節性トレンド）                        │
│    - campaign_characteristic（キャンペーン特性）             │
│  category           : ENUM（keyword / ad_copy / etc.）       │
│  description        : TEXT（インサイト内容）                  │
│  evidence           : JSON（根拠となる提案IDのリスト）        │
│  confidence         : DECIMAL（確信度 0-1）                   │
│  is_active          : BOOLEAN（有効/無効）                   │
└─────────────────────────────────────────────────────────────┘
```

#### 3.5.3 必須参照フロー（RAGアプローチ）

**新しい改善提案を生成する前に、以下のデータを必ずClaudeのコンテキストに含める：**

```
┌─────────────────────────────────────────────────────────────┐
│  STEP 1: 過去データ収集                                      │
├─────────────────────────────────────────────────────────────┤
│  ① 直近12週分の週次レポートサマリー                          │
│  ② 過去の全提案とその実行状況・効果結果                      │
│  ③ 蓄積されたlearning_insights                              │
│  ④ 今回と類似した状況での過去提案（カテゴリ・キャンペーン）   │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 2: コンテキスト構築                                    │
├─────────────────────────────────────────────────────────────┤
│  以下の形式でClaudeへのプロンプトに含める：                   │
│                                                              │
│  【過去の提案履歴と効果】                                    │
│  - 2026-02-03週：キーワードA除外 → CPA -12%（効果あり）       │
│  - 2026-01-27週：広告文変更 → CTR +5%（効果あり）             │
│  - 2026-01-20週：予算増額 → CPA +8%（効果なし・悪化）         │
│  ...                                                         │
│                                                              │
│  【学習済みインサイト】                                      │
│  - 「〇〇キャンペーン」は予算増でCPA悪化傾向（確信度0.8）      │
│  - 土日の配信停止はCV減少につながる（確信度0.7）              │
│  ...                                                         │
│                                                              │
│  【今週の状況】                                               │
│  （今週のGoogle Adsデータ）                                   │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 3: 提案生成時の制約                                    │
├─────────────────────────────────────────────────────────────┤
│  Claudeへの指示に以下を必ず含める：                          │
│                                                              │
│  「上記の過去履歴を踏まえて提案を行うこと。                   │
│   過去に効果がなかった施策は避け、                           │
│   効果があった施策のパターンを優先すること。                 │
│   各提案に、関連する過去の提案IDと                           │
│   その結果を参照として明記すること。」                       │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────┐
│  STEP 4: 提案出力と紐付け                                    │
├─────────────────────────────────────────────────────────────┤
│  生成された提案には以下を含める：                            │
│                                                              │
│  - related_past_proposals: [過去の関連提案IDリスト]          │
│  - reasoning: 「過去に〇〇で効果があったため、今回も...」     │
│  - contraindication: 「過去に△△は効果がなかったので避けた」 │
└─────────────────────────────────────────────────────────────┘
```

#### 3.5.4 インサイト自動生成

週次処理の中で、一定期間ごと（例：4週間ごと）に過去の提案→結果データを分析し、`learning_insights`テーブルに傾向を自動登録する。

**生成するインサイト例：**
- 「検索広告キャンペーンでの除外キーワード追加は、平均CPA -8%の効果」
- 「P-MAXでの画像差し替えは、効果にばらつきが大きい（確信度低）」
- 「月初は予算消化が遅い傾向、月末に集中しやすい」
- 「〇〇キャンペーンは土日のCTRが平日比+15%」

#### 3.5.5 キャンペーンの追加・終了への対応

**基本動作**
- 毎週のデータ取得時に、Google Ads APIから現時点のキャンペーン一覧を取得
- 新規・終了は自動的に検知される

**新規キャンペーンの場合**
```
┌─────────────────────────────────────────────────────────────┐
│  新規キャンペーン検知時の処理                                 │
├─────────────────────────────────────────────────────────────┤
│  1. 新規キャンペーンとしてフラグ立て                          │
│  2. 過去データがないため、以下を参照して提案：                │
│     - 同じ広告タイプ（検索/P-MAX等）の他キャンペーン傾向       │
│     - 類似カテゴリのlearning_insights                        │
│  3. 初回レポートには「新規のため効果検証は来週以降」と明記     │
│  4. 2週目以降は通常の提案サイクルに組み込み                   │
└─────────────────────────────────────────────────────────────┘
```

**終了・削除されたキャンペーンの場合**
```
┌─────────────────────────────────────────────────────────────┐
│  キャンペーン終了時の処理                                     │
├─────────────────────────────────────────────────────────────┤
│  1. ステータスを「ended」に更新（データは削除しない）          │
│  2. 過去の提案・効果データはすべて保持                        │
│  3. ダッシュボードの履歴画面では引き続き閲覧可能              │
│  4. 類似キャンペーンの参照データとして活用                    │
│  5. 週次レポートからは除外（アクティブのみ対象）              │
└─────────────────────────────────────────────────────────────┘
```

**データベース追加項目**

```
┌─────────────────────────────────────────────────────────────┐
│  campaigns（キャンペーン管理）                                │
├─────────────────────────────────────────────────────────────┤
│  campaign_id        : TEXT（Google Ads側のID）               │
│  campaign_name      : TEXT                                   │
│  campaign_type      : ENUM（search / display / pmax / video）│
│  status             : ENUM（active / paused / ended）        │
│  first_seen_at      : TIMESTAMP（初回検知日）                │
│  last_seen_at       : TIMESTAMP（最終検知日）                │
│  ended_at           : TIMESTAMP（終了日、該当時のみ）         │
└─────────────────────────────────────────────────────────────┘
```

#### 3.5.6 ダッシュボードでの履歴表示

| セクション | 内容 |
|-----------|------|
| 週次レポート一覧 | 過去の全レポートをリスト表示、クリックで詳細 |
| 提案履歴 | 全提案のリスト、ステータス・効果でフィルタ可能 |
| 提案→結果タイムライン | 提案→実行→効果測定の流れを時系列で表示 |
| 効果サマリー | カテゴリ別の提案成功率、平均効果 |
| インサイト一覧 | AIが発見したパターン・傾向のリスト |
| KPIトレンド | 主要KPIの長期推移グラフ |

**提案詳細画面：**
```
提案ID: xxx-xxx
提案日: 2026-02-10
カテゴリ: キーワード
タイトル: キャンペーン「〇〇」除外キーワード追加

【提案内容】
...

【関連する過去提案】
- 2026-01-13: 類似施策 → CPA -10%

【実行状況】
ステータス: 実行済み
実行日: 2026-02-10
実行者: 担当者A

【効果測定】
測定日: 2026-02-17（1週間後）
CPA: ¥3,200 → ¥2,850（-10.9%）
評価: 効果あり
```

---

### 3.6 競合分析機能

#### 3.6.1 概要

競合の動向を把握し、施策提案に反映する。データソースは2種類。

#### 3.6.2 データソース

```
┌─────────────────────────────────────────────────────────────┐
│  【Google Ads API経由】自動取得可能                          │
├─────────────────────────────────────────────────────────────┤
│  ・オークション分析レポート                                  │
│    - インプレッションシェア                                  │
│    - 上位表示率                                             │
│    - ページ上部表示率                                       │
│    - 重複率（競合との同時表示率）                            │
│    - 優位表示率                                             │
│  ・業界ベンチマーク（一部）                                  │
│    - 検索インプレッションシェア損失率（予算）                 │
│    - 検索インプレッションシェア損失率（ランク）               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  【外部ツール連携】別途API契約が必要                         │
├─────────────────────────────────────────────────────────────┤
│  ツール候補：SEMrush / SpyFu / SimilarWeb / Ahrefs          │
│                                                              │
│  取得可能データ：                                            │
│  ・競合の出稿キーワード（推定）                              │
│  ・競合の広告文・クリエイティブ（過去の出稿履歴）            │
│  ・競合の推定広告費・トラフィック                            │
│  ・業界平均CPA/CTR/CVR                                       │
│  ・キーワード別の競争度・CPC相場                             │
└─────────────────────────────────────────────────────────────┘
```

#### 3.6.3 競合リスト管理

**設定項目**
- 競合ドメインリスト（最大10社）
- 監視キーワードリスト（主要キーワード）
- 業界カテゴリ（ベンチマーク比較用）

**データベース追加**
```
┌─────────────────────────────────────────────────────────────┐
│  competitors（競合リスト）                                   │
├─────────────────────────────────────────────────────────────┤
│  competitor_id      : UUID                                   │
│  domain             : TEXT（例：competitor.co.jp）           │
│  company_name       : TEXT（表示名）                         │
│  is_active          : BOOLEAN                                │
│  created_at         : TIMESTAMP                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  competitor_snapshots（競合スナップショット）                 │
├─────────────────────────────────────────────────────────────┤
│  snapshot_id        : UUID                                   │
│  competitor_id      : FK → competitors                       │
│  captured_at        : TIMESTAMP                              │
│  ad_copies          : JSON（発見した広告文リスト）            │
│  keywords           : JSON（推定出稿キーワード）              │
│  estimated_spend    : DECIMAL（推定広告費）                   │
│  source             : TEXT（データ取得元ツール名）            │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│  auction_insights（オークション分析）                         │
├─────────────────────────────────────────────────────────────┤
│  insight_id         : UUID                                   │
│  report_id          : FK → weekly_reports                    │
│  competitor_domain  : TEXT                                   │
│  impression_share   : DECIMAL                                │
│  overlap_rate       : DECIMAL                                │
│  position_above_rate: DECIMAL                                │
│  top_of_page_rate   : DECIMAL                                │
│  outranking_share   : DECIMAL                                │
└─────────────────────────────────────────────────────────────┘
```

#### 3.6.4 競合分析の週次レポート項目

**オークション分析サマリー**
- 自社のインプレッションシェア推移
- 主要競合との表示率比較
- 順位変動があった競合のハイライト

**競合クリエイティブ動向**
- 新たに発見した競合の広告文
- 訴求ポイントの変化（価格訴求、機能訴求など）
- 自社広告との差別化ポイント

**キーワード動向**
- 競合が新たに出稿し始めたキーワード
- 競争が激化しているキーワード
- 自社が取れていないキーワード機会

**業界ベンチマーク比較**
- 業界平均CPAとの比較
- 業界平均CTRとの比較
- ポジション（上位/平均/下位）

#### 3.6.5 競合情報を踏まえた施策提案

**提案への反映ルール**
```
┌─────────────────────────────────────────────────────────────┐
│  提案生成時のコンテキストに以下を含める                       │
├─────────────────────────────────────────────────────────────┤
│  1. 直近の競合オークション分析データ                          │
│  2. 競合の最新広告文（差別化の参考）                          │
│  3. 競合が狙っているキーワード                                │
│  4. 業界ベンチマーク数値                                     │
│                                                              │
│  Claudeへの指示例：                                          │
│  「競合A社は"即日対応"を訴求している。自社の広告文で          │
│   差別化できるポイントを提案に含めること。」                  │
│                                                              │
│  「業界平均CPAは¥5,000。自社は¥3,200で優位だが、              │
│   さらに効率化できる余地があるか検討すること。」              │
└─────────────────────────────────────────────────────────────┘
```

**提案カテゴリ追加**
- `competitive_response`（競合対応）
  - 競合の動きへの対抗策
  - 差別化ポイントの強化
  - 競合が取っているキーワードへの参入/撤退判断

#### 3.6.6 外部ツール連携の選択肢（将来オプション）

| ツール | 月額目安 | 特徴 |
|--------|---------|------|
| SEMrush | $130〜 | 総合力高い、日本語対応 |
| SpyFu | $40〜 | 広告特化、安価 |
| SimilarWeb | 要問合せ | トラフィック分析に強い |

**Phase 1ではオークション分析のみ（Google Ads APIで取得可能）**
**Phase 2以降で外部ツール連携を検討**

---

## 4. ダッシュボード要件

### 4.1 概要
専用Webアプリとして構築。会長から現場作業者まで全員が閲覧。

### 4.2 UIデザイン方針

#### デザインコンセプト
- **データリッチ** — グラフ・数値を一画面で把握できる情報密度
- **ダークテーマ** — 黒ベースで目に優しく、データが映える
- **信号システム** — パッと見でOK/NGが分かる色分け

#### カラーパレット

```
【ベースカラー】
背景（メイン）    : #0D0D0D（ほぼ黒）
背景（カード）    : #1A1A1A（ダークグレー）
背景（ホバー）    : #252525
ボーダー         : #333333
テキスト（主）    : #FFFFFF
テキスト（副）    : #A0A0A0

【信号カラー（ステータス表示）】
好調・改善        : #22C55E（グリーン）
注意・横ばい      : #EAB308（イエロー）
要改善・悪化      : #EF4444（レッド）
ニュートラル      : #3B82F6（ブルー）

【アクセントカラー】
主要アクション    : #3B82F6（ブルー）
ハイライト       : #8B5CF6（パープル）
```

#### 信号システムの適用ルール

| 指標 | グリーン（好調） | イエロー（注意） | レッド（要改善） |
|------|-----------------|-----------------|-----------------|
| CPA | 目標比 -10%以下 | 目標比 ±10%以内 | 目標比 +10%超 |
| CTR | 前週比 +5%以上 | 前週比 ±5%以内 | 前週比 -5%超 |
| CV数 | 前週比 +10%以上 | 前週比 ±10%以内 | 前週比 -10%超 |
| 予算消化率 | 90-100% | 70-90% | 70%未満 or 超過 |
| 提案実行率 | 80%以上 | 50-80% | 50%未満 |

※ 閾値は設定画面で調整可能にする

#### レイアウト原則

```
┌─────────────────────────────────────────────────────────────┐
│  ヘッダー：ロゴ / 現在の週 / 最終更新日時 / ユーザー         │
├─────────────────────────────────────────────────────────────┤
│ サ │                                                        │
│ イ │  メインコンテンツエリア                                 │
│ ド │                                                        │
│ バ │  - カード形式でKPIを配置                               │
│ ｜ │  - グラフは大きめに表示                                │
│    │  - 信号色で状態を即座に把握                            │
│ ナ │                                                        │
│ ビ │                                                        │
└─────────────────────────────────────────────────────────────┘
```

**サイドバー（常時表示）**
- ダッシュボード（ホーム）
- キャンペーン一覧
- 週次レポート
- 改善提案
- 履歴・トレンド
- 設定

#### コンポーネント設計

**KPIカード**
```
┌────────────────────────┐
│  CPA                   │
│  ¥2,850     ●（緑）    │
│  ▼ -12% vs 先週        │
│  目標: ¥3,000          │
└────────────────────────┘
```
- 数値は大きく（24px以上）
- 信号色のドットまたはバー
- 前週比を小さく表示
- 目標値との比較

**グラフ表示**
- 折れ線グラフ：KPI推移（8週間分）
- 棒グラフ：キャンペーン別比較
- 背景に目標ラインを薄く表示
- ホバーで詳細数値表示

**提案カード**
```
┌────────────────────────────────────────┐
│ 🔴 優先度：高                          │
│ キーワード「〇〇」除外                  │
│ キャンペーン: 検索_ブランド             │
│ 期待効果: CPA -10%                     │
│                                        │
│ [承認] [却下] [詳細]                   │
└────────────────────────────────────────┘
```
- 優先度で色分け（高=赤、中=黄、低=青）
- アクションボタンは右下に配置

**テーブル**
- ストライプ不要（ダークテーマでは見づらい）
- 行ホバーで背景色変更
- ソート可能な列はアイコン表示
- ステータス列は信号色バッジ

#### レスポンシブ対応

| デバイス | 対応 |
|---------|------|
| デスクトップ（1280px以上） | フル機能 |
| タブレット（768px-1279px） | サイドバー折りたたみ |
| スマートフォン | サマリー表示のみ（詳細はPC推奨）|

#### アクセシビリティ
- 色だけでなくアイコン・テキストでも状態を表示
- コントラスト比 WCAG AA準拠
- キーボード操作対応

### 4.3 画面構成

**トップページ（サマリー）**
- 今週のハイライト（主要KPI）
- 前週比の変化（↑↓表示）
- 緊急度の高いアラート
- 未実行の改善提案数

**キャンペーン一覧**
- 全キャンペーンのKPI一覧
- ステータス表示（好調/要注意/要改善）
- フィルタ・ソート機能

**週次レポート詳細**
- 分析結果の全項目表示
- グラフ・チャートによる可視化
- 過去レポートとの比較

**改善提案一覧**
- 今週の提案リスト
- 優先度・カテゴリでフィルタ
- 実行ステータス管理（承認待ち/承認済み/実行済み/却下）

**実行チェック**
- 提案ごとの実行状況
- 実行後の効果測定結果

**履歴・トレンド**
- 長期パフォーマンス推移
- 施策効果の振り返り

### 4.4 ユーザー権限（将来拡張）

| 役割 | 閲覧 | 承認 | 設定変更 |
|------|------|------|---------|
| 会長・経営層 | ○ | - | - |
| 管理者 | ○ | ○ | ○ |
| 作業者 | ○ | - | - |

---

## 5. Chatwork連携機能

### 5.1 概要
週次レポート完成時にChatworkへ通知。作業担当者にメンションし、改善タスクをChatworkタスクとして自動登録する。

### 5.2 通知内容

**メッセージ構成**
```
[To:担当者アカウントID] 担当者名さん

━━━━━━━━━━━━━━━━━━
📊 週次Google広告レポート
期間：2026/02/10〜2026/02/16
━━━━━━━━━━━━━━━━━━

【今週のハイライト】
・費用：¥XXX,XXX（前週比 +X%）
・CV数：XX件（前週比 +X%）
・CPA：¥X,XXX（前週比 -X%）

【緊急度：高の改善提案】
1. キャンペーン「〇〇」のCPA悪化 → 除外キーワード追加
2. 広告文Bの差し替え推奨

【本日のタスク】
下記タスクが登録されました。月曜午前中に対応をお願いします。

📎 詳細レポート：[ダッシュボードURL]
```

### 5.3 タスク自動登録

**対象**
- 改善提案のうち「優先度：高」のもの
- 前週の未実行タスク（リマインド）

**タスク形式**
- タスク名：改善提案のタイトル
- 担当者：作業担当者（設定で指定）
- 期限：当日（月曜日）または指定日

**タスク例**
```
タスク名：【Google広告】キャンペーン「〇〇」除外キーワード追加
担当者：作業担当者
期限：2026-02-16
```

### 5.4 設定項目

| 項目 | 説明 |
|------|------|
| Chatwork APIトークン | Chatwork管理画面から取得 |
| 通知先ルームID | レポートを送信するルーム |
| 担当者アカウントID | メンション・タスク割り当て対象 |
| タスク期限 | デフォルトは送信当日 |

### 5.5 Chatwork API利用

- **メッセージ送信**: POST /rooms/{room_id}/messages
- **タスク追加**: POST /rooms/{room_id}/tasks
- APIレート制限：5分間に100リクエスト（十分な余裕あり）

---

## 6. 技術構成（提案）

### 6.1 バックエンド
- **言語**: Python または Node.js
- **フレームワーク**: FastAPI / Express
- **AI**: Claude API（分析・提案生成）
- **広告API**: Google Ads API

### 6.2 フロントエンド（ダッシュボード）
- **フレームワーク**: Next.js / React
- **UIライブラリ**: Tailwind CSS + shadcn/ui
- **グラフ**: Recharts / Chart.js

### 6.3 データベース
- **メイン**: PostgreSQL（履歴・メモリ保存）
- **キャッシュ**: Redis（オプション）

### 6.4 インフラ
- **ホスティング**: Vercel / Railway / Cloud Run
- **スケジューラ**: GitHub Actions / Cloud Scheduler

### 6.5 外部API連携
- Google Ads API
- Claude API
- Chatwork API

### 6.6 認証
- Google OAuth（既存のGoogle広告アカウントと連携）

---

## 7. 実行フロー

```
┌─────────────────────────────────────────────────────────┐
│  毎週日曜深夜〜月曜早朝（自動実行）                          │
├─────────────────────────────────────────────────────────┤
│  1. Google Ads APIからデータ取得                          │
│  2. 前週の提案の反映状況・効果検証                         │
│  3. Claude APIで分析・改善提案生成                         │
│  4. データベースに保存                                     │
│  5. ダッシュボード更新                                     │
│  6. Chatworkにレポート送信（担当者メンション）               │
│  7. Chatworkに改善タスク自動登録                           │
└─────────────────────────────────────────────────────────┘
          ↓
┌─────────────────────────────────────────────────────────┐
│  月曜午前（人間作業）                                      │
├─────────────────────────────────────────────────────────┤
│  1. ダッシュボードでレポート確認                            │
│  2. 改善提案を確認                                        │
│  3. 提案ごとに「承認」or「却下」を選択                      │
└─────────────────────────────────────────────────────────┘
          ↓
┌─────────────────────────────────────────────────────────┐
│  承認後（自動実行）                                        │
├─────────────────────────────────────────────────────────┤
│  1. Google Ads APIで変更を自動反映                         │
│  2. 反映結果（成功/失敗）をダッシュボードに表示              │
│  3. 失敗時はChatwork通知＋再実行オプション                  │
│  4. 変更履歴をデータベースに記録                            │
└─────────────────────────────────────────────────────────┘
          ↓
┌─────────────────────────────────────────────────────────┐
│  翌週（効果検証）                                          │
├─────────────────────────────────────────────────────────┤
│  1. 反映した施策の効果を自動測定                            │
│  2. 結果をメモリに保存（次回提案に反映）                     │
│  3. 効果レポートをダッシュボードに表示                       │
└─────────────────────────────────────────────────────────┘
```

---

## 8. 開発フェーズ

### Phase 1: MVP（最小構成）
- Google Ads API接続
- 週次データ取得
- **データベース構築（履歴蓄積の基盤）**
- Claude APIによる分析・提案生成
- シンプルなダッシュボード（レポート表示のみ）
- 手動実行（スケジューラなし）

### Phase 2: 自動化・通知
- 週次自動実行（スケジューラ）
- Chatwork連携（レポート送信・タスク登録）
- 改善提案の承認フロー
- **承認後の自動反映（Google Ads API書き込み）**
- **セーフガード実装（変更上限、ロールバック）**

### Phase 3: 履歴参照・効果検証
- **過去履歴の必須参照フロー（RAG）実装**
- 実行チェック機能
- 効果検証の自動化（1週間後測定）
- **learning_insightsの自動生成**
- ダッシュボードの履歴・トレンド画面

### Phase 4: 自律化（将来）
- 一定範囲の自動実行（承認不要）
- リアルタイム監視・アラート
- 予測モデルの導入

---

## 9. 成功指標

| 指標 | 目標 |
|------|------|
| CPA | 現状から20%削減 |
| ROAS | 現状から20%向上 |
| 作業時間 | 週次運用作業を50%削減 |
| 提案採用率 | 70%以上 |
| 提案効果実現率 | 60%以上 |

---

## 10. 注意事項・制約

- Google Ads API Explorer Access（1日2,880回）の範囲内で運用
- APIレート制限を考慮したバッチ処理設計
- 個人情報・機密データの取り扱いに注意
- 広告ポリシー違反となる提案を出さないよう制御

---

## 11. 次のステップ

1. この要件定義をClaude Codeに渡す
2. Phase 1（MVP）から開発開始
3. Google Ads API認証設定
4. 動作確認後、Phase 2以降へ

---

**作成日**: 2026-02-15
**バージョン**: 1.0
